extends "res://addons/gut/test.gd"

var sample_dat = [
	0xac, 0xaa, 0x02, 0x00, 0x01, 0x00, 0x46, 0x00, 0x01, 0x00, 0x02, 0x00,
	0x00, 0x00, 0x01, 0x00, 0x18, 0x00, 0xff, 0x63, 0x00, 0x6e, 0xff, 0x05,
	0x00, 0x15, 0xff, 0x3a, 0x00, 0x01, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00,
	0xff, 0xff, 0x00, 0xff, 0x5e, 0x00, 0x0f, 0x00, 0xff, 0xff, 0x00, 0xff,
	0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0xff, 0x00, 0xff, 0x04, 0x00, 0x11,
	0x00, 0x03, 0x08, 0x4c, 0x65, 0x76, 0x65, 0x6c, 0x20, 0x31, 0x00, 0x06,
	0x05, 0xd6, 0xda, 0xcd, 0xca, 0x00
]


var levelset = DatFile.new()
var num_tests = 0
var tests_done = 0

func _init():
	._init()
	for method in get_method_list():
		if method.name.begins_with("test_"):
			num_tests += 1

# Called when the node enters the scene tree for the first time.
func test_parse_file():
	levelset.stream.data_array = PoolByteArray(sample_dat)
	# assert_true(true, "true test")
	assert_true(levelset.parse_file(true), "tests Chip's Challenge levelset parsing")
	finish_test()


# this should be called at the end of every test
func finish_test():
	tests_done += 1
	if tests_done >= num_tests:
		levelset.free()
